
Структура папки: 
================= 
    temp_full.txt
    _BackgroundClasses.cshtml
    _Image.cshtml
    
Подпапки отсутствуют 

 
================= 
 
/_BackgroundClasses.cshtml: 
@using TestUmbraco.Models
@using TestUmbraco.Services
@model BackgroundClassesModel
@inject IUmbracoBackgroundService BackgroundService

@{
    // Получаем фоновые классы из сервиса
    var backgroundResult = await BackgroundService.ProcessBackground(
        Model.Settings, 
        Model.ComponentId, 
        Model.Prefix);
    
    var backgroundClass = backgroundResult?.CssClass ?? "";
    
    // Собираем все классы
    var allClasses = new List<string>();
    
    // Базовый класс компонента
    if (!string.IsNullOrWhiteSpace(Model.BaseClass))
    {
        allClasses.Add(Model.BaseClass.Trim());
    }
    
    // Фоновые классы
    if (!string.IsNullOrWhiteSpace(backgroundClass))
    {
        allClasses.Add(backgroundClass.Trim());
    }
    
    // Дополнительные классы
    if (!string.IsNullOrWhiteSpace(Model.AdditionalClasses))
    {
        allClasses.Add(Model.AdditionalClasses.Trim());
    }
    
    var finalClass = string.Join(" ", allClasses);
    var containerClass = Model.ContainerClass?.Trim() ?? "";
    var overlayClass = $"overlay-{Model.ComponentId:N}";
    var hasOverlay = backgroundResult?.HasOverlay ?? false;
    
    // Определяем тег обертки
    var wrapperTag = !string.IsNullOrWhiteSpace(Model.Tag) ? Model.Tag : "div";
}

<@wrapperTag class="@finalClass">
    <!-- Видео фон (если есть) -->
    @if (backgroundResult?.Type == BackgroundType.Video && !string.IsNullOrEmpty(backgroundResult.VideoId))
    {
        <div class="video-container">
            @if (backgroundResult.UseVideoPlaceholder && !string.IsNullOrEmpty(backgroundResult.VideoPlaceholder))
            {
                <div class="video-placeholder" 
                     style="background-image: url('@backgroundResult.VideoPlaceholder'); 
                            background-size: cover; 
                            background-position: center;
                            position: absolute;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            z-index: -1;">
                </div>
            }
            <iframe class="video-bg-iframe" 
                    src="https://player.vimeo.com/video/@backgroundResult.VideoId?background=1&autoplay=1&loop=1&byline=0&title=0&muted=1" 
                    frameborder="0" 
                    allow="autoplay; fullscreen" 
                    allowfullscreen>
            </iframe>
        </div>
    }
    
    <!-- Контейнер (если задан) -->
    @if (!string.IsNullOrWhiteSpace(containerClass))
    {
        <div class="@containerClass">
            @Model.Content?.Invoke(Model)
        </div>
    }
    else
    {
        @Model.Content?.Invoke(Model)
    }
</@wrapperTag> 
 
/_Image.cshtml: 
@using Umbraco.Cms.Core.Models.PublishedContent
@using TestUmbraco.Helpers
@inject ImageHelper ImageHelper

@model IPublishedContent?

@{
    var cssClass = ViewData["CssClass"] as string ?? "";
    var cropAlias = ViewData["CropAlias"] as string;
    var altText = ViewData["AltText"] as string ?? Model?.Name ?? "";
    var lazyLoad = ViewData["LazyLoad"] as bool? ?? true;
    var attributes = ViewData["Attributes"] as Dictionary<string, string>;
    
    // Уберите этот параметр - он не нужен
    // var skipWrapper = ViewData["SkipWrapper"] as bool? ?? false;
    
    // Просто всегда передаем skipWrapper: false в ImageHelper
    // но НЕ создаем свою обертку
}

@if (Model != null)
{
    try
    {
        if (ImageHelper != null)
        {
            // Используем skipWrapper: false, чтобы ImageHelper сам создал обертку
            var imageHtml = await ImageHelper.RenderResponsiveMediaAsync(
                media: Model,
                cropAlias: cropAlias,
                cssClass: cssClass,
                altText: altText,
                lazyLoad: lazyLoad,
                attributes: attributes,
                responsiveWidths: null,
                sizes: null,
                gridColumns: "col-12",
                includeWebp: true,
                skipWrapper: false  // Пусть ImageHelper создает обертку
            );
            
            if (imageHtml != null && !string.IsNullOrEmpty(imageHtml.ToString()))
            {
                @imageHtml
            }
            else
            {
                <img src="@Model.Url()" 
                     alt="@altText"
                     class="image-fallback @cssClass"
                     style="width:100%; height:auto; display:block; border:2px solid red;"
                     loading="lazy"
                     decoding="async" />
            }
        }
        else
        {
            <img src="@Model.Url()" 
                 alt="@altText"
                 class="image-fallback @cssClass"
                 style="width:100%; height:auto; display:block; border:2px solid red;"
                 loading="lazy"
                 decoding="async" />
        }
    }
    catch (Exception)
    {
        <img src="@Model.Url()" 
             alt="@altText"
             class="image-error @cssClass"
             style="width:100%; height:auto; display:block; border:2px solid red;"
             loading="lazy"
             decoding="async" />
    }
}
else
{
    <!-- Если изображение отсутствует -->
    <div class="image-placeholder @cssClass">
        <div class="placeholder-content">
            <svg class="placeholder-icon" width="40" height="40" viewBox="0 0 24 24">
                <path fill="#adb5bd" d="M21,3H3C1.9,3,1,3.9,1,5v14c0,1.1,0.9,2,2,2h18c1.1,0,2-0.9,2-2V5C23,3.9,22.1,3,21,3z M21,19H3V5h18V19z"/>
                <circle fill="#adb5bd" cx="9" cy="10" r="3"/>
                <path fill="#adb5bd" d="M19,7h-6v6h6V7z"/>
            </svg>
            <span class="placeholder-text">Нет изображения</span>
        </div>
    </div>
} 
 
