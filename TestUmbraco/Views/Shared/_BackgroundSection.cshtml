@using TestUmbraco.Models
@using TestUmbraco.Services
@inject IUmbracoBackgroundService BackgroundService
@model BackgroundSectionModel

@{
    // Получаем фоновые классы из сервиса
    var backgroundResult = await BackgroundService.ProcessBackground(Model.Settings, Model.ComponentId, Model.Prefix);
    var backgroundClass = backgroundResult.CssClass ?? "";
    
    // Собираем все классы
    var allClasses = new List<string>();
    
    // Базовый класс компонента
    if (!string.IsNullOrWhiteSpace(Model.BaseClass))
    {
        allClasses.Add(Model.BaseClass.Trim());
    }
    
    // Фоновые классы
    if (!string.IsNullOrWhiteSpace(backgroundClass))
    {
        allClasses.Add(backgroundClass.Trim());
    }
    
    // Дополнительные классы
    if (!string.IsNullOrWhiteSpace(Model.AdditionalClasses))
    {
        allClasses.Add(Model.AdditionalClasses.Trim());
    }
    
    var finalClass = string.Join(" ", allClasses);
    var containerClass = Model.ContainerClass?.Trim() ?? "";
    var overlayClass = $"overlay-{Model.ComponentId:N}";
    var hasOverlay = backgroundResult.HasOverlay;
}

<section class="@finalClass">
    <!-- Элемент оверлея -->
    @if (hasOverlay)
    {
        <div class="background-overlay"></div>
    }
    
    <!-- Видео фон -->
    @if (backgroundResult.Type == BackgroundType.Video && !string.IsNullOrEmpty(backgroundResult.VideoId))
    {
        <div class="video-container">
            @if (backgroundResult.UseVideoPlaceholder && !string.IsNullOrEmpty(backgroundResult.VideoPlaceholder))
            {
                <div class="video-placeholder" 
                     style="background-image: url('@backgroundResult.VideoPlaceholder'); 
                            background-size: cover; 
                            background-position: center;
                            position: absolute;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            z-index: -1;">
                </div>
            }
            <iframe class="video-bg-iframe" 
                    src="https://player.vimeo.com/video/@backgroundResult.VideoId?background=1&autoplay=1&loop=1&byline=0&title=0&muted=1" 
                    frameborder="0" 
                    allow="autoplay; fullscreen" 
                    allowfullscreen>
            </iframe>
        </div>
    }
    
    @if (!string.IsNullOrWhiteSpace(containerClass))
    {
        <div class="@containerClass">
            @Model.Content?.Invoke(Model)
        </div>
    }
    else
    {
        @Model.Content?.Invoke(Model)
    }
</section>