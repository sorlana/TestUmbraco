@using Umbraco.Cms.Core.Models.Blocks
@using Umbraco.Cms.Core.Models
@using TestUmbraco.Models
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<BlockGridItem>

@{
    // Приводим контент к правильному типу
    var separator = Model.Content;
    var settings = Model.Settings;
    
    // Проверяем, нужно ли применять фон к родителю
    var applyBackgroundToParent = ViewData["ApplyBackgroundToParent"] as bool? ?? false;
    
    // Получаем значение свойства "Class"
    var customClass = separator.Value<string>("Class");
    
    // Извлекаем класс анимации из строки вида "bounce (Привлекающие внимание)"
    if (!string.IsNullOrWhiteSpace(customClass) && customClass.Contains("("))
    {
        var animateClass = customClass.Split('(')[0].Trim();
        customClass = animateClass;
    }
    
    // Получаем изображение
    var image = separator.Value<IPublishedContent>("BgImg");
}

@if (image != null)
{
    @if (applyBackgroundToParent)
    {
        @* Фон применяется к родительскому элементу, рендерим только контент без обертки *@
        <img src="@image.Url()" alt="Separator image" class="separator" />
    }
    else
    {
        @* Обычный рендеринг с фоном *@
        // Создаем функцию для контента
        Func<object, Microsoft.AspNetCore.Html.IHtmlContent>? contentFunc = 
            @<text>
                <img src="@image.Url()" alt="Separator image" class="separator" />
            </text>;

        // Создаем модель для BackgroundClasses
        var backgroundModel = new BackgroundClassesModel
        {
            Settings = settings,
            ComponentId = separator.Key,
            Prefix = "separator-bg",
            BaseClass = customClass ?? "",
            AdditionalClasses = "",
            Tag = "div",
            ContainerClass = "",
            Content = contentFunc
        };

        // Рендерим через универсальный компонент
        <partial name="_BackgroundClasses" model="backgroundModel" />
    }
}