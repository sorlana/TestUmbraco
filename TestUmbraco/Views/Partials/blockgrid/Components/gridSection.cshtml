@using Umbraco.Cms.Core.Models.Blocks
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<BlockGridItem>

@{
    var content = Model.Content;
    var rows = content.Value<BlockListModel>("rows");
    
    var sectionClass = content.Value<string>("sectionClass");
    var containerClass = content.Value<string>("containerClass");
    
    <!-- DEBUG gridSection: Checking for background -->
    
    // Определяем класс для фона
    var bgClass = "";
    if (content.HasProperty("backgroundImage") && content.HasValue("backgroundImage"))
    {
        <text><!-- DEBUG gridSection: Has backgroundImage property --></text>
        var bgImage = content.Value<IPublishedContent>("backgroundImage");
        if (bgImage != null)
        {
            bgClass = $"grid-bg-{content.Key}";
            <text><!-- DEBUG gridSection: Using class: @bgClass --></text>
        }
        else
        {
            <text><!-- DEBUG gridSection: bgImage is NULL --></text>
        }
    }
    else
    {
        <text><!-- DEBUG gridSection: NO backgroundImage property --></text>
        // Добавляем тестовый класс для отладки
        bgClass = "test-bg-debug";
    }
}

@if (rows != null && rows.Any())
{
    <!-- DEBUG gridSection: Rendering section with class: @bgClass -->
    
    // Открываем section с классом или без
    if (string.IsNullOrWhiteSpace(sectionClass))
    {
        @:<section class="@bgClass">
    }
    else
    {
        @:<section class="@sectionClass.Trim() @bgClass">
    }
    
        <div class="container @(string.IsNullOrWhiteSpace(containerClass) ? "" : containerClass.Trim())">
            @foreach (var row in rows)
            {
                @await Html.PartialAsync($"blockgrid/Components/{row.Content.ContentType.Alias}", row)
            }
        </div>
    
    @:</section>
}
else
{
    <text><!-- DEBUG gridSection: No rows found --></text>
}