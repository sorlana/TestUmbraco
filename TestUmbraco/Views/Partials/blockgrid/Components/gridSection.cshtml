@using Umbraco.Cms.Core.Models.Blocks
@using TestUmbraco.Models
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<BlockGridItem>

@{
    var content = Model.Content;
    var settings = Model.Settings;
    var rows = content.Value<BlockListModel>("rows");
    
    // Получаем классы секции
    var sectionClass = "";
    var containerClass = "";
    
    if (settings != null)
    {
        sectionClass = settings.Value<string>("sectionClass") ?? "";
        containerClass = settings.Value<string>("containerClass") ?? "";
    }
    
    if (string.IsNullOrWhiteSpace(sectionClass))
    {
        sectionClass = content.Value<string>("sectionClass") ?? "";
    }
    
    if (string.IsNullOrWhiteSpace(containerClass))
    {
        containerClass = content.Value<string>("containerClass") ?? "";
    }
}

@if (rows != null && rows.Any())
{
    // Создаем функцию для контента
    Func<object, Microsoft.AspNetCore.Html.IHtmlContent> contentFunc = 
        @<text>
            @foreach (var row in rows)
            {
                @await Html.PartialAsync($"blockgrid/Components/{row.Content.ContentType.Alias}", row)
            }
        </text>;

    // Создаем модель для фона - используем новую структуру модели
    var backgroundModel = new BackgroundSectionModel
    {
        Settings = settings,
        ComponentId = content.Key,
        Prefix = "grid-bg",
        BaseClass = sectionClass.Trim(),  // Изменили с SectionClass на BaseClass
        ContainerClass = containerClass.Trim(),
        Content = contentFunc
        // WrapperTag больше не используется - все секции используют <section>
    };

    // Рендерим частичное представление
    <partial name="_BackgroundSection" model="backgroundModel" />
}