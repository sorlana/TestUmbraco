@using Umbraco.Cms.Core.Models.Blocks
@using TestUmbraco.Models
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<BlockGridItem>

@{
    var content = Model.Content;
    var settings = Model.Settings;
    var gridColumns = content.Value<BlockGridModel>("rows");
    
    var sectionClass = "";
    var containerClass = "";
    
    if (settings != null)
    {
        sectionClass = settings.Value<string>("sectionClass") ?? "";
        containerClass = settings.Value<string>("containerClass") ?? "";
    }
    
    if (string.IsNullOrWhiteSpace(sectionClass))
    {
        sectionClass = content.Value<string>("sectionClass") ?? "";
    }
    
    if (string.IsNullOrWhiteSpace(containerClass))
    {
        containerClass = content.Value<string>("containerClass") ?? "";
    }
}

@if (gridColumns != null && gridColumns.Any())
{
    // Создаем функцию для контента
    Func<object, Microsoft.AspNetCore.Html.IHtmlContent> contentFunc = 
        @<text>
            @foreach (var gridColumn in gridColumns)
            {
                @await Html.PartialAsync($"blockgrid/Components/{gridColumn.Content.ContentType.Alias}", gridColumn)
            }
        </text>;

    // Создаем модель для фона
    var backgroundModel = new BackgroundSectionModel
    {
        Settings = settings,
        ComponentId = content.Key,
        Prefix = "grid-bg",
        BaseClass = sectionClass.Trim(),
        ContainerClass = containerClass.Trim(),
        Content = contentFunc
    };

    // Рендерим частичное представление
    <partial name="_BackgroundSection" model="backgroundModel" />
}