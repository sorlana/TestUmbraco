# Примеры использования конструктора форм

Этот документ содержит практические примеры настройки форм в Umbraco CMS с использованием модуля "Конструктор форм". Каждый пример включает пошаговые инструкции по созданию и настройке формы в бэкофисе.

## Содержание

1. [Пример 1: Форма обратной связи](#пример-1-форма-обратной-связи)
2. [Пример 2: Форма подписки на рассылку](#пример-2-форма-подписки-на-рассылку)
3. [Советы по настройке](#советы-по-настройке)
4. [Часто задаваемые вопросы](#часто-задаваемые-вопросы)

---

## Пример 1: Форма обратной связи

Форма обратной связи - это классический пример использования конструктора форм. Она позволяет посетителям сайта отправить сообщение с контактной информацией.

### Описание формы

**Назначение:** Сбор обращений от посетителей сайта с их контактными данными

**Поля формы:**
- Имя (обязательное текстовое поле)
- Email (обязательное поле с валидацией email)
- Телефон (необязательное поле с валидацией формата)
- Сообщение (обязательное многострочное текстовое поле)

### Пошаговая инструкция

#### Шаг 1: Создание формы

1. Войдите в бэкофис Umbraco
2. Перейдите в раздел **Content**
3. Найдите страницу, на которой хотите разместить форму
4. Если используете Block Grid/Block List:
   - Нажмите **Add content** в соответствующем свойстве
   - Выберите **formBuilderBlock**
5. Если используете отдельную страницу:
   - Создайте новую страницу типа **formBuilderBlock**

#### Шаг 2: Настройка вкладки "Form Settings"

Заполните следующие поля:

**Form Title:**
```
Свяжитесь с нами
```

**Form Description:**
```
Заполните форму ниже, и мы свяжемся с вами в ближайшее время
```

**Submit Button Text:**
```
Отправить сообщение
```

#### Шаг 3: Добавление полей формы

Теперь добавим 4 поля в **Form Fields**. Нажмите **Add content** для каждого поля:

##### Поле 1: Имя

| Свойство | Значение |
|----------|----------|
| **Field Label** | Ваше имя |
| **Field Type** | text |
| **Field Placeholder** | Введите ваше имя |
| **Is Required** | ✓ (включено) |
| **Validation Pattern** | *(оставить пустым)* |
| **Error Message** | *(оставить пустым)* |

##### Поле 2: Email

| Свойство | Значение |
|----------|----------|
| **Field Label** | Email адрес |
| **Field Type** | email |
| **Field Placeholder** | example@mail.com |
| **Is Required** | ✓ (включено) |
| **Validation Pattern** | *(оставить пустым - встроенная валидация email)* |
| **Error Message** | Пожалуйста, введите корректный email адрес |

##### Поле 3: Телефон

| Свойство | Значение |
|----------|----------|
| **Field Label** | Номер телефона |
| **Field Type** | phone |
| **Field Placeholder** | +7 (999) 123-45-67 |
| **Is Required** | ☐ (выключено - необязательное поле) |
| **Validation Pattern** | `^\+?[0-9\s\-\(\)]{10,20}$` |
| **Error Message** | Введите корректный номер телефона |

**Примечание:** Регулярное выражение `^\+?[0-9\s\-\(\)]{10,20}$` позволяет:
- Опциональный знак `+` в начале
- Цифры, пробелы, дефисы и скобки
- Длина от 10 до 20 символов

##### Поле 4: Сообщение

| Свойство | Значение |
|----------|----------|
| **Field Label** | Ваше сообщение |
| **Field Type** | textarea |
| **Field Placeholder** | Расскажите, чем мы можем вам помочь... |
| **Is Required** | ✓ (включено) |
| **Validation Pattern** | *(оставить пустым)* |
| **Error Message** | *(оставить пустым)* |

#### Шаг 4: Настройка вкладки "Email Settings"

Переключитесь на вкладку **Email Settings** и заполните:

**Email Recipient:**
```
info@yourcompany.com
```
*(Замените на реальный email адрес, куда должны приходить сообщения)*

**Email Subject:**
```
Новое сообщение с формы обратной связи
```

**Success Message:**
```
Спасибо за ваше сообщение! Мы свяжемся с вами в ближайшее время.
```

**Redirect Page:**
*(Оставьте пустым, если хотите показать Success Message. Или выберите страницу "Спасибо", если она существует)*

#### Шаг 5: Сохранение и публикация

1. Нажмите **Save and Publish** (или **Submit**, если это блок)
2. Откройте страницу на фронтенде
3. Проверьте отображение формы

### Результат

После настройки форма будет выглядеть примерно так:

```
┌─────────────────────────────────────────┐
│  Свяжитесь с нами                       │
│  Заполните форму ниже, и мы свяжемся    │
│  с вами в ближайшее время               │
│                                         │
│  Ваше имя *                             │
│  [Введите ваше имя.....................]│
│                                         │
│  Email адрес *                          │
│  [example@mail.com.....................]│
│                                         │
│  Номер телефона                         │
│  [+7 (999) 123-45-67...................]│
│                                         │
│  Ваше сообщение *                       │
│  [Расскажите, чем мы можем вам помочь..]│
│  [......................................] │
│  [......................................] │
│                                         │
│  [Отправить сообщение]                  │
└─────────────────────────────────────────┘
```

### Пример полученного email

Когда посетитель отправит форму, вы получите email следующего вида:

```
Тема: Новое сообщение с формы обратной связи

Свяжитесь с нами

Дата отправки: 10.02.2025 14:30
IP адрес: 192.168.1.100

Данные формы:
┌──────────────────┬────────────────────────────────┐
│ Ваше имя         │ Иван Петров                    │
│ Email адрес      │ ivan.petrov@example.com        │
│ Номер телефона   │ +7 (999) 123-45-67             │
│ Ваше сообщение   │ Здравствуйте! Хочу узнать      │
│                  │ подробнее о ваших услугах...   │
└──────────────────┴────────────────────────────────┘
```

---

## Пример 2: Форма подписки на рассылку

Форма подписки - это простая форма для сбора email адресов подписчиков с согласием на обработку персональных данных.

### Описание формы

**Назначение:** Сбор email адресов для рассылки новостей и акций

**Поля формы:**
- Email (обязательное поле с валидацией email)
- Согласие на обработку данных (обязательный checkbox)

### Пошаговая инструкция

#### Шаг 1: Создание формы

1. Войдите в бэкофис Umbraco
2. Перейдите в раздел **Content**
3. Найдите страницу, на которой хотите разместить форму подписки
4. Добавьте новый блок **formBuilderBlock**

#### Шаг 2: Настройка вкладки "Form Settings"

**Form Title:**
```
Подпишитесь на нашу рассылку
```

**Form Description:**
```
Получайте первыми информацию о новых акциях и специальных предложениях
```

**Submit Button Text:**
```
Подписаться
```

#### Шаг 3: Добавление полей формы

Добавим 2 поля в **Form Fields**:

##### Поле 1: Email

| Свойство | Значение |
|----------|----------|
| **Field Label** | Ваш email |
| **Field Type** | email |
| **Field Placeholder** | your@email.com |
| **Is Required** | ✓ (включено) |
| **Validation Pattern** | *(оставить пустым)* |
| **Error Message** | Пожалуйста, введите корректный email адрес |

##### Поле 2: Согласие на обработку данных

| Свойство | Значение |
|----------|----------|
| **Field Label** | Я согласен на обработку персональных данных и получение рассылки |
| **Field Type** | checkbox |
| **Field Placeholder** | *(оставить пустым - не применимо для checkbox)* |
| **Is Required** | ✓ (включено) |
| **Validation Pattern** | *(оставить пустым)* |
| **Error Message** | Необходимо дать согласие на обработку данных |

**Важно:** Для checkbox поле **Field Label** будет отображаться справа от чекбокса как кликабельный текст.

#### Шаг 4: Настройка вкладки "Email Settings"

**Email Recipient:**
```
marketing@yourcompany.com
```
*(Email адрес отдела маркетинга или ответственного за рассылку)*

**Email Subject:**
```
Новая подписка на рассылку
```

**Success Message:**
```
Спасибо за подписку! Проверьте вашу почту для подтверждения.
```

**Redirect Page:**
*(Можно выбрать страницу "Спасибо за подписку" или оставить пустым)*

#### Шаг 5: Сохранение и публикация

1. Нажмите **Save and Publish**
2. Проверьте форму на фронтенде

### Результат

Форма подписки будет выглядеть компактно:

```
┌─────────────────────────────────────────┐
│  Подпишитесь на нашу рассылку           │
│  Получайте первыми информацию о новых   │
│  акциях и специальных предложениях      │
│                                         │
│  Ваш email *                            │
│  [your@email.com......................]│
│                                         │
│  ☐ Я согласен на обработку персональных │
│     данных и получение рассылки *       │
│                                         │
│  [Подписаться]                          │
└─────────────────────────────────────────┘
```

### Пример полученного email

```
Тема: Новая подписка на рассылку

Подпишитесь на нашу рассылку

Дата отправки: 10.02.2025 15:45
IP адрес: 192.168.1.105

Данные формы:
┌──────────────────────────────────────┬─────────────────────────┐
│ Ваш email                            │ user@example.com        │
│ Я согласен на обработку персональных │ true                    │
│ данных и получение рассылки          │                         │
└──────────────────────────────────────┴─────────────────────────┘
```

### Дополнительные рекомендации для формы подписки

1. **Double Opt-In:** Рассмотрите возможность добавления процесса подтверждения email через письмо с ссылкой
2. **GDPR Compliance:** Убедитесь, что текст согласия соответствует требованиям законодательства
3. **Ссылка на политику конфиденциальности:** Можно добавить в Field Label ссылку на политику:
   ```
   Я согласен на обработку персональных данных согласно <a href="/privacy-policy">политике конфиденциальности</a>
   ```

---

## Советы по настройке

### Валидация телефонных номеров

Для разных форматов телефонов используйте соответствующие регулярные выражения:

**Российские номера (+7):**
```regex
^\+?7[\s\-]?\(?[0-9]{3}\)?[\s\-]?[0-9]{3}[\s\-]?[0-9]{2}[\s\-]?[0-9]{2}$
```

**Международный формат:**
```regex
^\+?[0-9\s\-\(\)]{10,20}$
```

**Только цифры (10 цифр):**
```regex
^\d{10}$
```

### Валидация имен

Если хотите ограничить ввод только буквами:

**Только кириллица:**
```regex
^[А-Яа-яЁё\s\-]{2,50}$
```

**Кириллица и латиница:**
```regex
^[А-Яа-яЁёA-Za-z\s\-]{2,50}$
```

### Настройка длины текста

Для ограничения длины сообщения:

**Минимум 10 символов:**
```regex
^.{10,}$
```

**От 10 до 500 символов:**
```regex
^.{10,500}$
```

### Использование Redirect Page

**Когда использовать Success Message:**
- Для простых форм (подписка, быстрая связь)
- Когда пользователь должен остаться на той же странице
- Для лучшего UX с Toast notifications

**Когда использовать Redirect Page:**
- Для важных форм (заказ, регистрация)
- Когда нужно показать дополнительную информацию
- Для отслеживания конверсий (страница "Спасибо" с аналитикой)

### Оптимизация для мобильных устройств

Форма автоматически адаптируется под мобильные устройства, но учтите:

1. **Используйте короткие labels** - они лучше читаются на маленьких экранах
2. **Минимизируйте количество полей** - чем меньше полей, тем выше конверсия на мобильных
3. **Правильные типы полей** - используйте `email` и `phone` для автоматической клавиатуры на мобильных

---

## Часто задаваемые вопросы

### Как добавить поле выбора из списка (select)?

1. Создайте поле с типом **select**
2. В текущей версии опции для select нужно настраивать в коде представления
3. Альтернатива: используйте несколько полей типа **radio** для выбора одного варианта

### Можно ли добавить файловое поле для загрузки документов?

В текущей версии конструктора форм загрузка файлов не поддерживается. Это функциональность для будущих версий.

### Как изменить стили формы?

Форма использует стандартные CSS классы:
- `.form-builder-block` - контейнер формы
- `.form-title` - заголовок
- `.form-description` - описание
- `.form-group` - группа поля
- `.form-control` - поле ввода
- `.btn-primary` - кнопка отправки

Добавьте свои стили в CSS файл вашей темы.

### Как настроить reCAPTCHA?

reCAPTCHA настраивается в файле `appsettings.json`:

```json
{
  "ReCaptcha": {
    "SiteKey": "ваш-site-key",
    "SecretKey": "ваш-secret-key"
  }
}
```

Получите ключи на [https://www.google.com/recaptcha/admin](https://www.google.com/recaptcha/admin)

### Куда сохраняются отправки форм?

Все отправки сохраняются в таблицу `FormSubmissions` в базе данных. Для просмотра отправок можно создать отдельный раздел в бэкофисе или использовать SQL запросы.

### Как изменить email шаблон?

Email шаблон формируется в методе `BuildFormSubmissionHtml` класса `EmailService`. Для изменения внешнего вида письма отредактируйте этот метод в файле `TestUmbraco.Application/Services/EmailService.cs`.

### Можно ли отправлять форму на несколько email адресов?

В текущей версии поддерживается один получатель. Для отправки на несколько адресов:
1. Используйте email адрес группы/списка рассылки
2. Или модифицируйте код `EmailService` для поддержки нескольких получателей

### Как добавить поле с датой?

Добавьте поле с типом **text** и используйте валидацию для формата даты:

**Validation Pattern для даты (ДД.ММ.ГГГГ):**
```regex
^(0[1-9]|[12][0-9]|3[01])\.(0[1-9]|1[012])\.(19|20)\d\d$
```

**Field Placeholder:**
```
ДД.ММ.ГГГГ
```

### Форма не отправляется, что делать?

Проверьте:
1. ✓ Все обязательные поля заполнены
2. ✓ Email адрес корректный
3. ✓ Валидация по паттернам проходит
4. ✓ reCAPTCHA настроена правильно
5. ✓ В консоли браузера (F12) нет ошибок JavaScript
6. ✓ В логах Umbraco нет ошибок

---

## Дополнительные примеры

### Пример 3: Форма заказа обратного звонка (краткая версия)

**Поля:**
1. Имя (text, required)
2. Телефон (phone, required, pattern: `^\+?7[\s\-]?\(?[0-9]{3}\)?[\s\-]?[0-9]{3}[\s\-]?[0-9]{2}[\s\-]?[0-9]{2}$`)
3. Удобное время для звонка (text, optional)

**Email Subject:** "Заказ обратного звонка"

### Пример 4: Форма записи на консультацию (краткая версия)

**Поля:**
1. Имя (text, required)
2. Email (email, required)
3. Телефон (phone, required)
4. Тема консультации (textarea, required)
5. Предпочитаемая дата (text, optional, placeholder: "ДД.ММ.ГГГГ")

**Email Subject:** "Новая запись на консультацию"

---

## Заключение

Конструктор форм Umbraco CMS предоставляет гибкий инструмент для создания различных типов форм без программирования. Используйте эти примеры как отправную точку и адаптируйте их под свои нужды.

**Полезные ссылки:**
- [Руководство по настройке Document Types](FORM_BUILDER_SETUP_GUIDE.md)
- [Документация Umbraco CMS](https://docs.umbraco.com/)
- [Regex тестер](https://regex101.com/) - для проверки регулярных выражений

---

**Версия документа:** 1.0  
**Дата обновления:** 10.02.2025  
**Автор:** Команда разработки TestUmbraco
