# Действия после завершения задачи

## Обязательные проверки перед завершением

### 1. Сборка проекта
После внесения изменений в код всегда выполняйте сборку:

```cmd
dotnet build
```

Убедитесь, что сборка прошла успешно без ошибок.

### 2. Проверка TypeScript (если изменялись .ts файлы)
Если вносились изменения в TypeScript файлы:

```cmd
npm run build:plugins
```

Проверьте, что компиляция прошла без ошибок.

### 3. Проверка запуска приложения
Запустите приложение и убедитесь, что оно стартует без ошибок:

```cmd
cd TestUmbraco
dotnet run
```

Проверьте:
- Приложение запустилось на http://localhost:5000
- Нет критических ошибок в консоли
- Бэк-офис Umbraco доступен по адресу http://localhost:5000/umbraco

### 4. Проверка логов
Просмотрите логи на наличие ошибок:

```cmd
type TestUmbraco\Logs\log-<текущая_дата>.txt
```

Обратите внимание на записи с уровнем `[ERR]` или `[FTL]`.

## Рекомендуемые действия

### Для изменений в коде C#

1. **Форматирование кода** (если установлен dotnet-format):
```cmd
dotnet format
```

2. **Проверка предупреждений**:
```cmd
dotnet build /warnaserror
```

3. **Очистка и пересборка** (при значительных изменениях):
```cmd
dotnet clean
dotnet build
```

### Для изменений в базе данных

1. **Создание миграции** (если изменялись модели):
```cmd
cd TestUmbraco.Domain
dotnet ef migrations add <ОписаниеИзменения> --startup-project ../TestUmbraco
```

2. **Применение миграции**:
```cmd
dotnet ef database update --startup-project ../TestUmbraco
```

3. **Проверка миграций**:
```cmd
dotnet ef migrations list --startup-project ../TestUmbraco
```

### Для изменений в конфигурации

1. **Проверка appsettings.json**:
   - Убедитесь, что JSON валиден
   - Проверьте, что все необходимые секции присутствуют
   - Проверьте строки подключения

2. **Проверка зависимостей**:
```cmd
dotnet list package
```

### Для изменений в плагинах Umbraco

1. **Проверка структуры App_Plugins**:
   - Убедитесь, что файлы скопированы в `wwwroot/App_Plugins/`
   - Проверьте наличие `umbraco-package.json`

2. **Очистка кэша Umbraco**:
```cmd
rmdir /s /q TestUmbraco\App_Data\TEMP
```

3. **Перезапуск приложения** для загрузки изменений в плагинах

## Git workflow

### Перед коммитом

1. **Проверка статуса**:
```cmd
git status
```

2. **Просмотр изменений**:
```cmd
git diff
```

3. **Добавление файлов**:
```cmd
git add .
# или выборочно
git add <конкретные_файлы>
```

4. **Коммит**:
```cmd
git commit -m "Описание изменений"
```

### Рекомендации по коммитам

- Используйте понятные сообщения коммитов на русском или английском
- Группируйте связанные изменения в один коммит
- Не коммитьте файлы из `bin/`, `obj/`, `node_modules/`, `Logs/`

## Docker workflow

### После изменений в коде

1. **Пересборка образа**:
```cmd
docker-compose build
```

2. **Перезапуск контейнера**:
```cmd
docker-compose down
docker-compose up -d
```

3. **Проверка логов**:
```cmd
docker-compose logs -f
```

## Тестирование изменений

### Минимальный набор проверок

1. **Функциональность**:
   - Проверьте, что новая функциональность работает как ожидается
   - Проверьте, что существующая функциональность не сломалась

2. **Бэк-офис Umbraco**:
   - Откройте http://localhost:5000/umbraco
   - Проверьте, что бэк-офис загружается
   - Проверьте кастомные плагины (если изменялись)

3. **API endpoints** (если изменялись контроллеры):
   - Проверьте API endpoints через браузер или Postman
   - Пример: http://localhost:5000/api/background/multiple?backgrounds=...

4. **Frontend** (если изменялись views или CSS):
   - Проверьте отображение страниц
   - Проверьте responsive поведение
   - Проверьте консоль браузера на ошибки JavaScript

## Документирование изменений

### Обновление документации

Если изменения значительные, рассмотрите обновление:
- README.md (если есть)
- Комментарии в коде
- XML-документация для публичных API
- Файлы в `.kiro/steering/` (если есть специфичные для проекта инструкции)

### Changelog

Для значительных изменений рассмотрите ведение CHANGELOG.md с записями:
- Дата изменения
- Описание изменений
- Затронутые компоненты
- Breaking changes (если есть)

## Чеклист завершения задачи

- [ ] Код собирается без ошибок (`dotnet build`)
- [ ] TypeScript компилируется без ошибок (если применимо)
- [ ] Приложение запускается (`dotnet run`)
- [ ] Нет критических ошибок в логах
- [ ] Функциональность работает как ожидается
- [ ] Бэк-офис Umbraco доступен и работает
- [ ] Изменения зафиксированы в Git (если применимо)
- [ ] Документация обновлена (если необходимо)
- [ ] Миграции базы данных применены (если применимо)
- [ ] Docker образ пересобран (если используется Docker)

## Частые проблемы и решения

### Проблема: Приложение не запускается
**Решение**:
1. Проверьте логи в `TestUmbraco/Logs/`
2. Проверьте строку подключения к БД в appsettings.json
3. Убедитесь, что SQL Server запущен
4. Попробуйте `dotnet clean` и `dotnet build`

### Проблема: Изменения в TypeScript не применяются
**Решение**:
1. Проверьте, что файлы скомпилированы: `npm run build:plugins`
2. Проверьте путь вывода в tsconfig.json
3. Очистите кэш браузера (Ctrl+F5)
4. Перезапустите приложение

### Проблема: Плагины не отображаются в бэк-офисе
**Решение**:
1. Проверьте наличие файлов в `wwwroot/App_Plugins/`
2. Проверьте `umbraco-package.json` в папке плагина
3. Очистите кэш Umbraco: `rmdir /s /q TestUmbraco\App_Data\TEMP`
4. Перезапустите приложение

### Проблема: Ошибки миграций Entity Framework
**Решение**:
1. Проверьте, что startup-project указан правильно
2. Проверьте строку подключения
3. Попробуйте удалить последнюю миграцию: `dotnet ef migrations remove`
4. Пересоздайте миграцию с правильными изменениями
