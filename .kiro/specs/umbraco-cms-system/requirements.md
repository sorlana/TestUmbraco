# Требования к системе TestUmbraco

## 1. Обзор проекта

TestUmbraco - это веб-приложение на базе CMS Umbraco 17.1.0 с расширенными возможностями управления контентом, оптимизации изображений и кастомными плагинами для бэк-офиса.

### 1.1 Цель проекта

Создание современной системы управления контентом с акцентом на:
- Производительность и оптимизацию медиа-контента
- Удобство работы редакторов в бэк-офисе
- Адаптивность и современные веб-стандарты
- Расширяемость через кастомные плагины

### 1.2 Целевая аудитория

- **Редакторы контента**: работа с материалами через бэк-офис Umbraco
- **Администраторы**: управление структурой сайта и настройками
- **Разработчики**: расширение функционала через плагины и сервисы
- **Конечные пользователи**: посетители веб-сайта

## 2. Функциональные требования

### 2.1 Управление контентом

#### 2.1.1 Базовые возможности CMS
- **FR-2.1.1.1**: Система должна предоставлять полнофункциональный бэк-офис Umbraco для управления контентом
- **FR-2.1.1.2**: Система должна поддерживать создание, редактирование, публикацию и удаление страниц
- **FR-2.1.1.3**: Система должна поддерживать работу с медиа-библиотекой (изображения, документы)
- **FR-2.1.1.4**: Система должна поддерживать многоязычность контента
- **FR-2.1.1.5**: Система должна предоставлять предпросмотр контента перед публикацией

#### 2.1.2 Синхронизация контента (uSync)
- **FR-2.1.2.1**: Система должна поддерживать экспорт/импорт структуры контента через файлы
- **FR-2.1.2.2**: Система должна синхронизировать Document Types, Data Types и Templates
- **FR-2.1.2.3**: Система должна обеспечивать версионирование структуры контента

### 2.2 Оптимизация изображений

#### 2.2.1 Responsive изображения
- **FR-2.2.1.1**: Система должна автоматически генерировать адаптивные изображения с srcset
- **FR-2.2.1.2**: Система должна поддерживать следующие размеры по умолчанию: 400, 600, 800, 1000, 1200, 1920 пикселей
- **FR-2.2.1.3**: Система должна генерировать атрибут sizes на основе Bootstrap grid классов
- **FR-2.2.1.4**: Система должна использовать элемент `<picture>` для максимальной совместимости

#### 2.2.2 Форматы изображений
- **FR-2.2.2.1**: Система должна поддерживать конвертацию изображений в формат WebP
- **FR-2.2.2.2**: Система должна предоставлять fallback на JPEG/PNG для старых браузеров
- **FR-2.2.2.3**: Система должна позволять настраивать качество WebP (по умолчанию 80%)
- **FR-2.2.2.4**: Система должна позволять настраивать качество JPEG (по умолчанию 85%)

#### 2.2.3 Производительность
- **FR-2.2.3.1**: Система должна поддерживать нативный lazy loading для изображений
- **FR-2.2.3.2**: Система должна использовать атрибут decoding="async" для асинхронной декодировки
- **FR-2.2.3.3**: Система должна кэшировать сгенерированный HTML изображений
- **FR-2.2.3.4**: Система должна кэшировать CSS для фоновых изображений

#### 2.2.4 Placeholder и fallback
- **FR-2.2.4.1**: Система должна отображать placeholder при отсутствии изображения
- **FR-2.2.4.2**: Система должна предоставлять fallback при ошибке загрузки изображения
- **FR-2.2.4.3**: Placeholder должен содержать SVG иконку и текст "Нет изображения"

### 2.3 Управление фоновыми изображениями

#### 2.3.1 UniversalBackground плагин
- **FR-2.3.1.1**: Система должна предоставлять кастомный property editor для управления фонами
- **FR-2.3.1.2**: Плагин должен позволять выбирать изображение из медиа-библиотеки
- **FR-2.3.1.3**: Плагин должен позволять настраивать параметры фона (size, position, repeat)
- **FR-2.3.1.4**: Плагин должен генерировать уникальные CSS классы для каждого компонента

#### 2.3.2 API для фоновых изображений
- **FR-2.3.2.1**: Система должна предоставлять API endpoint `/api/background/multiple` для получения CSS
- **FR-2.3.2.2**: API должен принимать параметр backgrounds с ID фоновых изображений
- **FR-2.3.2.3**: API должен возвращать готовый CSS код с медиа-запросами
- **FR-2.3.2.4**: API должен кэшировать сгенерированный CSS

### 2.4 Отправка email

#### 2.4.1 Формы обратной связи
- **FR-2.4.1.1**: Система должна поддерживать отправку email-заявок с форм сайта
- **FR-2.4.1.2**: Система должна поддерживать два типа форм: email-запрос и запрос звонка
- **FR-2.4.1.3**: Система должна валидировать данные форм на сервере
- **FR-2.4.1.4**: Система должна отображать уведомления об успехе/ошибке отправки

#### 2.4.2 Защита от спама
- **FR-2.4.2.1**: Система должна интегрировать Google reCAPTCHA v3
- **FR-2.4.2.2**: Минимальный порог score для reCAPTCHA должен быть 0.5
- **FR-2.4.2.3**: Система должна блокировать отправку при низком score

#### 2.4.3 Конфигурация email
- **FR-2.4.3.1**: Система должна поддерживать настройку SMTP сервера через конфигурацию
- **FR-2.4.3.2**: Система должна поддерживать SSL/TLS соединение
- **FR-2.4.3.3**: Система должна позволять настраивать отправителя и получателя
- **FR-2.4.3.4**: Система должна использовать MailKit для отправки email

### 2.5 Кастомные плагины бэк-офиса

#### 2.5.1 MenuIdPicker
- **FR-2.5.1.1**: Плагин должен предоставлять property editor для выбора ID меню
- **FR-2.5.1.2**: Плагин должен интегрироваться с бэк-офисом Umbraco

#### 2.5.2 ColorSelector
- **FR-2.5.2.1**: Плагин должен предоставлять property editor для выбора цвета
- **FR-2.5.2.2**: Плагин должен отображать цветовую палитру

#### 2.5.3 Block Preview
- **FR-2.5.3.1**: Система должна поддерживать предпросмотр Block Grid в бэк-офисе
- **FR-2.5.3.2**: Система должна поддерживать предпросмотр Block List в бэк-офисе
- **FR-2.5.3.3**: Предпросмотр должен загружать стили Bootstrap и кастомные CSS
- **FR-2.5.3.4**: Предпросмотр должен загружать JavaScript для lazy loading

### 2.6 Кэширование медиа

#### 2.6.1 Управление кэшем
- **FR-2.6.1.1**: Система должна предоставлять API для управления кэшем медиа
- **FR-2.6.1.2**: API должен позволять очищать кэш для конкретного медиа-файла
- **FR-2.6.1.3**: API должен позволять очищать весь кэш медиа
- **FR-2.6.1.4**: API должен предоставлять информацию о состоянии кэша

#### 2.6.2 Авторизация
- **FR-2.6.2.1**: API управления кэшем должен быть доступен только авторизованным пользователям бэк-офиса
- **FR-2.6.2.2**: Система должна использовать политику авторизации "BackOffice"

### 2.7 SEO и оптимизация

#### 2.7.1 SEO Toolkit
- **FR-2.7.1.1**: Система должна интегрировать SEO Toolkit для управления мета-данными
- **FR-2.7.1.2**: Система должна поддерживать генерацию sitemap
- **FR-2.7.1.3**: Система должна предоставлять инструменты аудита сайта

## 3. Нефункциональные требования

### 3.1 Производительность

#### 3.1.1 Время отклика
- **NFR-3.1.1.1**: Время загрузки страницы не должно превышать 3 секунды
- **NFR-3.1.1.2**: API endpoints должны отвечать в течение 500 мс
- **NFR-3.1.1.3**: Генерация CSS для фонов должна занимать не более 200 мс

#### 3.1.2 Кэширование
- **NFR-3.1.2.1**: Кэш изображений должен храниться 365 дней
- **NFR-3.1.2.2**: Кэш браузера для изображений должен быть 7 дней
- **NFR-3.1.2.3**: Система должна использовать in-memory кэш для часто используемых данных

#### 3.1.3 Оптимизация
- **NFR-3.1.3.1**: Система должна использовать сжатие Gzip для статических ресурсов
- **NFR-3.1.3.2**: Система должна минифицировать CSS и JavaScript в production
- **NFR-3.1.3.3**: Система должна использовать CDN для Bootstrap

### 3.2 Масштабируемость

#### 3.2.1 Архитектура
- **NFR-3.2.1.1**: Система должна использовать многослойную архитектуру (Presentation, Application, Domain)
- **NFR-3.2.1.2**: Система должна использовать Dependency Injection для управления зависимостями
- **NFR-3.2.1.3**: Система должна использовать Repository Pattern для доступа к данным

#### 3.2.2 База данных
- **NFR-3.2.2.1**: Система должна поддерживать Microsoft SQL Server
- **NFR-3.2.2.2**: Система должна использовать Entity Framework Core для ORM
- **NFR-3.2.2.3**: Система должна поддерживать миграции базы данных

### 3.3 Безопасность

#### 3.3.1 Аутентификация и авторизация
- **NFR-3.3.1.1**: Система должна использовать встроенную систему аутентификации Umbraco
- **NFR-3.3.1.2**: Система должна поддерживать JWT токены для API
- **NFR-3.3.1.3**: Административные API должны требовать авторизации

#### 3.3.2 Защита данных
- **NFR-3.3.2.1**: Пароли должны храниться в зашифрованном виде
- **NFR-3.3.2.2**: Система должна защищать от SQL Injection через параметризованные запросы
- **NFR-3.3.2.3**: Система должна защищать от XSS через автоматическое экранирование в Razor

#### 3.3.3 HTTPS
- **NFR-3.3.3.1**: В production система должна использовать HTTPS
- **NFR-3.3.3.2**: Система должна поддерживать перенаправление с HTTP на HTTPS

### 3.4 Надежность

#### 3.4.1 Логирование
- **NFR-3.4.1.1**: Система должна логировать все ошибки с полным stack trace
- **NFR-3.4.1.2**: Система должна использовать структурированное логирование (Serilog)
- **NFR-3.4.1.3**: Логи должны записываться в файлы с ротацией по дням
- **NFR-3.4.1.4**: Логи должны храниться минимум 7 дней

#### 3.4.2 Обработка ошибок
- **NFR-3.4.2.1**: Система должна корректно обрабатывать все исключения
- **NFR-3.4.2.2**: Пользователь должен видеть понятные сообщения об ошибках
- **NFR-3.4.2.3**: Критические ошибки должны логироваться с уровнем Error

#### 3.4.3 Резервное копирование
- **NFR-3.4.3.1**: Система должна поддерживать резервное копирование базы данных
- **NFR-3.4.3.2**: Медиа-файлы должны храниться в отдельной директории для упрощения бэкапа

### 3.5 Совместимость

#### 3.5.1 Браузеры
- **NFR-3.5.1.1**: Система должна поддерживать современные версии Chrome, Firefox, Safari, Edge
- **NFR-3.5.1.2**: Система должна предоставлять fallback для старых браузеров (IE11+)

#### 3.5.2 Устройства
- **NFR-3.5.2.1**: Интерфейс должен быть адаптивным для desktop, tablet, mobile
- **NFR-3.5.2.2**: Бэк-офис должен корректно работать на планшетах

#### 3.5.3 Технологии
- **NFR-3.5.3.1**: Система должна работать на .NET 10.0
- **NFR-3.5.3.2**: Система должна поддерживать развертывание в Docker контейнерах
- **NFR-3.5.3.3**: Система должна работать на Windows и Linux

### 3.6 Поддерживаемость

#### 3.6.1 Код
- **NFR-3.6.1.1**: Код должен следовать принципам SOLID
- **NFR-3.6.1.2**: Код должен быть покрыт XML-документацией для публичных API
- **NFR-3.6.1.3**: Код должен использовать async/await для всех I/O операций

#### 3.6.2 Конфигурация
- **NFR-3.6.2.1**: Все настройки должны храниться в appsettings.json
- **NFR-3.6.2.2**: Чувствительные данные должны храниться в переменных окружения
- **NFR-3.6.2.3**: Система должна поддерживать разные конфигурации для Development/Production

#### 3.6.3 Развертывание
- **NFR-3.6.3.1**: Система должна поддерживать развертывание через Docker Compose
- **NFR-3.6.3.2**: Dockerfile должен использовать multi-stage build
- **NFR-3.6.3.3**: Система должна поддерживать volume mounting для медиа-файлов

### 3.7 Локализация

#### 3.7.1 Интерфейс
- **NFR-3.7.1.1**: Сообщения об ошибках должны быть на русском языке
- **NFR-3.7.1.2**: Уведомления пользователю должны быть на русском языке
- **NFR-3.7.1.3**: Placeholder для изображений должен содержать текст на русском

## 4. Технические ограничения

### 4.1 Платформа
- **TC-4.1.1**: Система должна работать на .NET 10.0
- **TC-4.1.2**: Система должна использовать Umbraco CMS 17.1.0
- **TC-4.1.3**: Система должна использовать Entity Framework Core 10.0.0

### 4.2 База данных
- **TC-4.2.1**: Система должна использовать Microsoft SQL Server
- **TC-4.2.2**: Строка подключения должна поддерживать TrustServerCertificate=true

### 4.3 Внешние зависимости
- **TC-4.3.1**: Система должна использовать MailKit для отправки email
- **TC-4.3.2**: Система должна использовать Google reCAPTCHA v3
- **TC-4.3.3**: Система должна использовать Bootstrap 5.3.0 для стилей

### 4.4 Размеры и лимиты
- **TC-4.4.1**: Максимальный размер загружаемого файла: 10 МБ
- **TC-4.4.2**: Максимальный размер буфера запроса: 1 МБ
- **TC-4.4.3**: Timeout запроса: 90 секунд

## 5. Критерии приемки

### 5.1 Функциональность
- ✅ Все функциональные требования реализованы
- ✅ Система успешно проходит ручное тестирование
- ✅ API endpoints возвращают корректные данные
- ✅ Формы отправляют email корректно

### 5.2 Производительность
- ✅ Страницы загружаются менее чем за 3 секунды
- ✅ API отвечает менее чем за 500 мс
- ✅ Изображения оптимизированы и используют WebP

### 5.3 Безопасность
- ✅ Административные API защищены авторизацией
- ✅ reCAPTCHA работает корректно
- ✅ Нет SQL Injection и XSS уязвимостей

### 5.4 Совместимость
- ✅ Сайт корректно отображается в современных браузерах
- ✅ Адаптивная верстка работает на всех устройствах
- ✅ Система развертывается в Docker без ошибок

### 5.5 Документация
- ✅ Код содержит XML-документацию
- ✅ README содержит инструкции по развертыванию
- ✅ Конфигурация документирована

## 6. Приоритеты

### Высокий приоритет (Must Have)
- Базовые возможности CMS
- Оптимизация изображений
- Отправка email
- Кэширование

### Средний приоритет (Should Have)
- Кастомные плагины бэк-офиса
- Block Preview
- SEO Toolkit
- Управление фонами

### Низкий приоритет (Nice to Have)
- Расширенная аналитика
- Дополнительные форматы изображений
- Интеграция с внешними сервисами

## 7. Риски и ограничения

### 7.1 Технические риски
- **R-7.1.1**: .NET 10.0 может быть нестабильным (preview версия)
- **R-7.1.2**: Umbraco 17.1.0 может содержать баги
- **R-7.1.3**: Производительность может снизиться при большом количестве изображений

### 7.2 Бизнес-риски
- **R-7.2.1**: Изменение требований в процессе разработки
- **R-7.2.2**: Недостаточная производительность на слабом оборудовании

### 7.3 Ограничения
- **L-7.3.1**: Система требует SQL Server (не поддерживает SQLite)
- **L-7.3.2**: Система требует SMTP сервер для отправки email
- **L-7.3.3**: Система требует Google reCAPTCHA ключи
